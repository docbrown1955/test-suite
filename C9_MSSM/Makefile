# Part depending on the generated library

NAME    = C9_MSSM
NAMELIB = libc9_mssm

INCPATH = -Iclib -Iinclude 
LIBPATH = 
LIBS    = -looptools-quad -lgfortran -lquadmath  -lgsl -lgslcblas

# Part common to all libraries generated by CSL

CXX     = /usr/bin/g++-11
CC      = /usr/bin/gcc-11
CXXSTD  = -std=c++17
CSTD    = -std=c11
MATH_OPTI = \
		-fno-math-errno\
		-ffinite-math-only\
		-fno-rounding-math\
		-fno-signaling-nans\
		-fcx-limited-range\
		-fexcess-precision=fast\
		-fno-signed-zeros\
		-fno-trapping-math\
		-fassociative-math\
		-freciprocal-math

DEFAULTFLAGS = -Wall -Wextra -Wpedantic -Wno-deprecated-declarations -fPIC
OPTIFLAGS = -O1 $(MATH_OPTI)
QUADFLAGS = -DQUAD=1 -DQUADSIZE=16
CXXFLAGS  = $(CXXSTD) $(DEFAULTFLAGS) $(OPTIFLAGS) $(QUADFLAGS)
CFLAGS    = $(CSTD) $(DEFAULTFLAGS) $(OPTIFLAGS) $(QUADFLAGS)
LINKFLAGS = $(DEFAULTFLAGS) $(QUADFLAGS)

SRCDIR = src
INCDIR = include
OBJDIR = obj
CLIBDIR = clib
SCRIPTDIR = script
SOBJDIR = script/obj
BINDIR = bin
LIBDIR = lib

SRC 	 = $(wildcard $(SRCDIR)/*.cpp)
CSRC 	 = $(wildcard $(CLIBDIR)/*.c)
HEADERS  = $(wildcard $(INCDIR)/*.h)
OBJ      = $(SRC:$(SRCDIR)/%.cpp=$(OBJDIR)/%.o)
COBJ     = $(CSRC:$(CLIBDIR)/%.c=$(CLIBDIR)/%.o)
SCRIPTS  = $(wildcard $(SCRIPTDIR)/*.cpp)
BINARIES = $(SCRIPTS:$(SCRIPTDIR)/%.cpp=%.x)
SOBJ = $(SCRIPTS:$(SCRIPTDIR)/%.cpp=$(SOBJDIR)/%.o)

all: scripts lib

scripts: $(BINARIES)
lib: $(NAMELIB).so $(NAMELIB).a

$(CLIBDIR)/%.o: $(CLIBDIR)/%.c
	$(CC) $(CFLAGS) -c $< -o $@ $(INCPATH)

$(OBJDIR)/%.o: $(SRCDIR)/%.cpp
	$(CXX) $(CXXFLAGS) -c $< -o $@ $(INCPATH)

$(SOBJDIR)/%.o: $(SCRIPTDIR)/%.cpp
	$(CXX) $(CXXFLAGS) -c $< -o $@ $(INCPATH)

%.x: $(SOBJDIR)/%.o $(OBJ) $(COBJ)
	$(CXX) $(CXXSTD) $(LINKFLAGS) -o $(BINDIR)/$@ $^ $(INCPATH) $(LIBPATH) $(LIBS)

$(NAMELIB).so: $(OBJ) $(COBJ)
	$(CXX) $(CXXFLAGS) -shared -o $(LIBDIR)/$@ $^ $(LIBPATH) $(LIBS)
$(NAMELIB).a: $(OBJ) $(COBJ)
	ar rcs $(LIBDIR)/$@ $^

clean:
	-rm $(OBJDIR)/*.o
	-rm $(BINDIR)/*.x
	-rm $(CLIBDIR)/*.o
	-rm $(LIBDIR)/*.a
	-rm $(LIBDIR)/*.so
